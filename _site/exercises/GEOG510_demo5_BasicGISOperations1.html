<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="In Class Demonstration #5 ">
<meta name="author" content="GEOG 510, GIS and Spatial Analysis in Public Health ">
<meta name="author" content="Varun Goel">

<title>GEOG 510 - Basic GIS Operations: Select, Field Calculator, Load Layer from web source</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">GEOG 510</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-materials" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Materials</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-materials">    
        <li>
    <a class="dropdown-item" href="../lectures.html" rel="" target="">
 <span class="dropdown-text">Lectures</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../readings.html" rel="" target="">
 <span class="dropdown-text">Readings</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../exercises.html" rel="" target="">
 <span class="dropdown-text">Exercises</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../assignments.html" rel="" target="">
 <span class="dropdown-text">Assignments</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-resources" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Resources</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-resources">    
        <li>
    <a class="dropdown-item" href="../software.html" rel="" target="">
 <span class="dropdown-text">Software Requirements and Resources</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../data.html" rel="" target="">
 <span class="dropdown-text">Data Resources</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../tutorials.html" rel="" target="">
 <span class="dropdown-text">Tutorials and Technical Resources</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../mapping.html" rel="" target="">
 <span class="dropdown-text">Map Submission Checklist</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#preparation-field-types-of-.csv-files" id="toc-preparation-field-types-of-.csv-files" class="nav-link active" data-scroll-target="#preparation-field-types-of-.csv-files">Preparation (field types of .csv files)</a></li>
  <li><a href="#basic-attribute-query-selection" id="toc-basic-attribute-query-selection" class="nav-link" data-scroll-target="#basic-attribute-query-selection">Basic Attribute Query (Selection)</a></li>
  <li><a href="#select-by-location" id="toc-select-by-location" class="nav-link" data-scroll-target="#select-by-location">Select by Location</a></li>
  <li><a href="#selection-example" id="toc-selection-example" class="nav-link" data-scroll-target="#selection-example">Selection Example</a>
  <ul class="collapse">
  <li><a href="#field-calculator" id="toc-field-calculator" class="nav-link" data-scroll-target="#field-calculator">Field Calculator</a></li>
  <li><a href="#data-wrangling" id="toc-data-wrangling" class="nav-link" data-scroll-target="#data-wrangling">Data Wrangling</a></li>
  <li><a href="#more-data-wrangling" id="toc-more-data-wrangling" class="nav-link" data-scroll-target="#more-data-wrangling">More Data Wrangling</a></li>
  <li><a href="#select-from-selection" id="toc-select-from-selection" class="nav-link" data-scroll-target="#select-from-selection">Select From Selection</a></li>
  <li><a href="#field-summary" id="toc-field-summary" class="nav-link" data-scroll-target="#field-summary">Field Summary</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Basic GIS Operations: Select, Field Calculator, Load Layer from web source</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Authors</div>
    <div class="quarto-title-meta-contents">
             <p>In Class Demonstration #5  </p>
             <p>GEOG 510, GIS and Spatial Analysis in Public Health  </p>
             <p>Varun Goel </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<div class="cell">
<style type="text/css">
a {
  color: royalblue;
}

a:hover {
  color: darkorange;
}

div.highlightblock { 
 background-color: #e0f0ff; 
 padding: 10px 10px 3px 10px;
}
</style>
</div>
<hr>
<p>This demonstration focuses on selecting features via queries in QGIS, calculating new fields, and highlighting some oft-encountered issues in a GIS-based analysis.</p>
<p>If you want to follow along, the <a href="https://drive.google.com/file/d/1NFHyRD0lfjyORsBH0HlSPsuYzRtOfrpx/view?usp=sharing">data can be downloaded here</a>.</p>
<p><strong>Note that throughout this document, if I use the term “right click,” this means “control click” for Mac users!</strong></p>
<hr>
<section id="preparation-field-types-of-.csv-files" class="level3">
<h3 class="anchored" data-anchor-id="preparation-field-types-of-.csv-files">Preparation (field types of .csv files)</h3>
<ol type="1">
<li><p>Start a new project in QGIS and add Tracts_CB_500k_2010_NC.gpkg to the Layers panel. Change the CRS to EPSG:32119, <code>NAD83 / North Carolina</code>.</p></li>
<li><p>Using the Browser panel in QGIS, drag PLACES_2023_tract_NC.csv to the Layers panel. Open the attribute table and view the data.</p></li>
<li><p>Open the Properties of PLACES_2023_tract_NC.csv by right-clicking on it in the Layers panel. In the Layer Properties window, navigate to Fields (on the left). What do you notice about the <code>Type</code>? Does this make sense given what you saw in the attribute table?</p></li>
<li><p>Close the Layer Properties window and the attribute table. Remove PLACES_2023_tract_NC.csv from the Layers Panel.</p></li>
<li><p>Open the Data Source Manager. In the pop up window, on the left, choose Delimited Text. Choose PLACES_2023_tract_NC.csv for the File name. Click the arrow next to Record and Fields Options to expand the content. Make sure that <strong>Detect field types</strong> is selected! In the Sample Data area (at the bottom), make sure that all fields that should be <code>Decimal (double)</code> are tagged as this type. In the Geometry Definition area, make sure the **No geometry* is selected. Click Add.</p></li>
<li><p>Open the Properties of PLACES_2023_tract_NC.csv and navigate to Fields (on the left) to confirm that the fields now have the correct data type. Close the Properties window.</p></li>
</ol>
<hr>
</section>
<section id="basic-attribute-query-selection" class="level3">
<h3 class="anchored" data-anchor-id="basic-attribute-query-selection">Basic Attribute Query (Selection)</h3>
<p>In this section, we will perform a simple select by attributes operation by selecting features from the tracts layer based on the value in the <code>CENSUSAREA</code> field.</p>
<ol start="7" type="1">
<li><p>Open the attribute table of Tracts_CB_500k_2010_NC. Click the button to Select features using an expression to open the Select by Expression window.</p></li>
<li><p>Build the following query in the expression area (via typing, copy/paste, or graphically), which will select all tracts having a value greater than 100 in the CENSUSAREA field:</p>
<p><code>"CENSUSAREA" &gt; 100</code></p></li>
<li><p>Click the Select Features button. You should notice that some features are highlighted in both the attribute table (in blue) and on the map (in yellow). Note on the map, these are all the largest tracts (which should make sense given the query).</p></li>
<li><p>Test the following selection-related operations and functionality:</p>
<ul>
<li>Invert selection</li>
<li>Zoom to selection</li>
<li>Display only selected features (bottow left of attribute table)</li>
<li>Deselect features <br><br></li>
</ul></li>
<li><p>Make sure that all features are deselected.</p></li>
</ol>
<hr>
</section>
<section id="select-by-location" class="level3">
<h3 class="anchored" data-anchor-id="select-by-location">Select by Location</h3>
<p>In this section, we will select features based on their location. The simplest (but probably not very useful/helpful) way to do this is simply via graphical interaction with the map.</p>
<ol start="12" type="1">
<li><p>Use the Select Features by Area or Single Click tool to select one or more features. Use “shift” click, to add additional features to the selection.</p></li>
<li><p>Make sure that all features are deselected.</p></li>
</ol>
<p>A more interesting approach to selecting features by location is to select features in one layer based on their spatial relationship with features in another layer. In the following part of the demo, we will select the tracts that have a hospital located within their boundaries. But, before we do this, we will learn how to add a layer from a website using an <strong>Open Geospatial Consortium Web Feature Service (OGC WFS)</strong>.</p>
<section id="add-layer-via-ogc-wfs" class="level4 highlightblock">
<h4 class="anchored" data-anchor-id="add-layer-via-ogc-wfs">Add Layer via OGC WFS</h4>
<ol start="14" type="1">
<li><p>Navigate to https://www.nconemap.gov/datasets/0b5a8fe009144b9bbeb7c4cee9ab7fa9_0/explore. On the bottom left, click on the button for “I want to use this”. Click the little navy blue button with two squares on it under OGC WFS. This will copy the web location to your computer’s clipboard.</p></li>
<li><p>In QGIS, open the Data Source Manager. In the pop up window, on the left, choose <strong>WFS / OGC API - Features</strong>. Click the New button, provide a name (e.g., NC One Map Hospitals) and paste the web location from the prior step into the URL box. Leave everything else on the default settings and click OK.</p></li>
<li><p>Your connection should now be listed at the top. Click the Connect button and you should see 4 entries populated in the window below. Make sure that Hospitals is selected and click the Add button on the bottom right of the Data Source Manager window (if you can see the Layers panel, you should be able to see it appear!). Click Close.</p></li>
</ol>
</section>
<p><br></p>
<ol start="17" type="1">
<li>Click the button for Select by Location (or go to Vector | Research Tools | Select by Location). In this case we will be selecting features from <code>Tracts_CB_500k_2010_NC</code> where the features <code>intersect</code> comparing to the hospitals layer. Click OK. How many tracts were selected?</li>
</ol>
<section id="export-selected-features" class="level4 highlightblock">
<h4 class="anchored" data-anchor-id="export-selected-features">Export Selected Features</h4>
<p>It is important to remember that selecting features does not alter the original data layer in any way. If you want to save the selected features, you must export them to a new layer.</p>
<ol start="18" type="1">
<li>Right click on the Tracts_CB_500k_2010_NC layer in the Layers Panel and choose Export | Save Selected Features As. Write the output to a .gpkg file on your computer. Deselect all features after exporting.</li>
</ol>
</section>
<p><br></p>
</section>
<section id="selection-example" class="level2">
<h2 class="anchored" data-anchor-id="selection-example">Selection Example</h2>
<p>In the next section, we will be working through the steps required to select all tracts with a large number of people that have not received the Colon Cancer screen who live near a hospital (e.g., to identify a potential intervention population). There are a number of steps that are required to complete this compound selection analysis.</p>
<p>I want to use table join to join the attribute data from the PLACES table to the spatial features in the tracts data. However, there is no key field to do this join, so we must create one!</p>
<section id="field-calculator" class="level3">
<h3 class="anchored" data-anchor-id="field-calculator">Field Calculator</h3>
<ol start="19" type="1">
<li><p>Open the Field Calculator (either in the main view of QGIS or from the attribute table of Tracts_CB_500k_2010_NC). To create a GEOID field that matches the PLACES data, we will concatenate data from three fields to create a matching entry. Make sure that Create a new field is checked. Give the new output field the name <code>GEOID</code> and make it a Text field type.</p></li>
<li><p>In the Expression area, type, copy/paste, or graphically build the following expression, then click OK:</p>
<p><code>concat(  "STATE" ,  "COUNTY" ,  "TRACT" )</code> <br><br></p></li>
</ol>
<section id="preview" class="level5 highlightblock">
<h5 class="anchored" data-anchor-id="preview">Preview</h5>
<p>If you are unsure whether your expression will produce the desired output, look near the bottom left of the Field Calculator window to see a preview of the output from the expression!</p>
</section>
<p><br></p>
</section>
<section id="data-wrangling" class="level3">
<h3 class="anchored" data-anchor-id="data-wrangling">Data Wrangling</h3>
<ol start="21" type="1">
<li><p>Use table join to join the attributes from the PLACES data table to the Tracts_CB_500k_2010_NC layer.</p></li>
<li><p>Use the field calculator to create a new field with the number of people who are not up date on colon cancer screening (<code>COLON_SCREEN</code> is percent of people up to date). Make sure that the new field is Decimal type. The calculation is as follows:</p>
<p><code>((100 - "PLACES_2023_tract_NC_COLON_SCREEN") / 100) *  "PLACES_2023_tract_NC_TotalPopulation"</code> <br><br></p></li>
</ol>
<section id="select-within-a-distance" class="level4">
<h4 class="anchored" data-anchor-id="select-within-a-distance">Select Within a Distance</h4>
<p>Next, we will select tracts within 2 miles of each hospital location.</p>
<ol start="23" type="1">
<li>If the Processing Toolbox is not open, go to View | Panels | Processing Toolbox. In the Processing Toolbox, expand the arrow for Vector selection, and then select Select within distance. Choose Tracts_CB_500k_2010_NC for Select features from and the Hospitals layer for the By comparing to the features from. Uh oh… notice that <strong>Where the features are within</strong> (this is the distance) is defined in <em>degrees</em>. This is because the tracts data layer uses decimal degrees in its CRS. Click Close.</li>
</ol>
</section>
</section>
<section id="more-data-wrangling" class="level3">
<h3 class="anchored" data-anchor-id="more-data-wrangling">More Data Wrangling</h3>
<ol start="24" type="1">
<li>Export the Tracts_CB_500k_2010_NC layer as a new layer, <strong>but make sure to choose Project CRS: ESPG:32119… as the CRS!</strong> Save at Tracts_CB_500k_2010_NC_CRS32119.gpkg.</li>
</ol>
<section id="select-within-a-distance-redux" class="level4">
<h4 class="anchored" data-anchor-id="select-within-a-distance-redux">Select Within a Distance (Redux)</h4>
<ol start="25" type="1">
<li>In the Processing Toolbox, expand the arrow for Vector selection, and then select Select within distance. Choose Tracts_CB_500k_2010_NC_CRS32119 for Select features from and the Hospitals layer for the By comparing to the features from. In the <strong>Where the features are within</strong> area choose 2 miles. Click Run.</li>
</ol>
</section>
</section>
<section id="select-from-selection" class="level3">
<h3 class="anchored" data-anchor-id="select-from-selection">Select From Selection</h3>
<ol start="26" type="1">
<li>Use the Select by Expression (attribute selection) tool to select only tracts that have <strong>more than 1000 people</strong> not up date on colon cancer screening. Since you only want to select tracts from those selected in the prior step, click the little arrow next to the Select Features button and choose <code>Filter Current Selection</code>. How many tracts meet the criteria of more than 1000 not up date on colon cancer screening and within 2 miles of a hospital?</li>
</ol>
</section>
<section id="field-summary" class="level3">
<h3 class="anchored" data-anchor-id="field-summary">Field Summary</h3>
<ol start="27" type="1">
<li>Use the Show Statistical Summary tool to determine the total population estimate in meeting the above criteria.</li>
</ol>
<hr>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>