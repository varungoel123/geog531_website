<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="In Class Exercise #7 ">
<meta name="author" content="GEOG 510, GIS &amp; Spatial Analysis in Public Health ">
<meta name="author" content="20 points">
<meta name="author" content="Varun Goel">

<title>GEOG 510 - Spatial Autocorrelation Analysis with GeoDa</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">GEOG 510</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-materials" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Materials</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-materials">    
        <li>
    <a class="dropdown-item" href="../lectures.html" rel="" target="">
 <span class="dropdown-text">Lectures</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../readings.html" rel="" target="">
 <span class="dropdown-text">Readings</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../exercises.html" rel="" target="">
 <span class="dropdown-text">Exercises</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../assignments.html" rel="" target="">
 <span class="dropdown-text">Assignments</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-resources" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Resources</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-resources">    
        <li>
    <a class="dropdown-item" href="../software.html" rel="" target="">
 <span class="dropdown-text">Software Requirements and Resources</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../data.html" rel="" target="">
 <span class="dropdown-text">Data Resources</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../tutorials.html" rel="" target="">
 <span class="dropdown-text">Tutorials and Technical Resources</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../mapping.html" rel="" target="">
 <span class="dropdown-text">Map Submission Checklist</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#data" id="toc-data" class="nav-link active" data-scroll-target="#data">Data</a></li>
  <li><a href="#open-geoda-and-load-data" id="toc-open-geoda-and-load-data" class="nav-link" data-scroll-target="#open-geoda-and-load-data">Open GeoDa and Load Data</a></li>
  <li><a href="#map-and-calculate-incidence-rate" id="toc-map-and-calculate-incidence-rate" class="nav-link" data-scroll-target="#map-and-calculate-incidence-rate">Map and Calculate Incidence Rate</a></li>
  <li><a href="#define-neighbors" id="toc-define-neighbors" class="nav-link" data-scroll-target="#define-neighbors">Define Neighbors</a></li>
  <li><a href="#global-spatial-autocorrelation" id="toc-global-spatial-autocorrelation" class="nav-link" data-scroll-target="#global-spatial-autocorrelation">Global Spatial Autocorrelation</a></li>
  <li><a href="#local-spatial-autocorrelation" id="toc-local-spatial-autocorrelation" class="nav-link" data-scroll-target="#local-spatial-autocorrelation">Local Spatial Autocorrelation</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Spatial Autocorrelation Analysis with GeoDa</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Authors</div>
    <div class="quarto-title-meta-contents">
             <p>In Class Exercise #7  </p>
             <p>GEOG 510, GIS &amp; Spatial Analysis in Public Health  </p>
             <p>20 points </p>
             <p>Varun Goel </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<div class="cell">
<style type="text/css">
a {
  color: royalblue;
}

a:hover {
  color: darkorange;
}

div.highlightblock { 
 background-color: #e0f0ff; 
 padding: 10px 10px 3px 10px;
}
</style>
</div>
<hr>
<p>In this exercise, you will work with Lyme Disease incidence data in North Carolina to determine whether Lyme disease incidence has a discernible spatial pattern and whether there are clusters of Zip Codes with high/low incidence. Open a word doc, save it as ‘youruserid_ex7.docx’ and answer the following questions.</p>
<p><strong>Note that throughout this document, if I use the term “right click,” this means “control click” for Mac users!</strong></p>
<hr>
<section id="data" class="level3">
<h3 class="anchored" data-anchor-id="data">Data</h3>
<ol type="1">
<li><a href="https://drive.google.com/file/d/1OBgOwYhjag9dv0_cShenVY5ahOH6AmlA/view?usp=sharing">Download the data here</a> and unzip.</li>
</ol>
<hr>
</section>
<section id="open-geoda-and-load-data" class="level3">
<h3 class="anchored" data-anchor-id="open-geoda-and-load-data">Open GeoDa and Load Data</h3>
<ol start="2" type="1">
<li><p>Open GeoDa. Create a new project and load data by navigating in the top menu to File | New (or click the button that looks like a folder) and choosing NC_ZIP_Lyme_2016_2018.gpkg from the exercise7 data folder (or by dragging the file into the specified area from Finder/Explorer). This layer contains incident cases of Lyme Disease by Zip Code over the years 2016-2018 in North Carolina.</p></li>
<li><p>The button to see the attribute table looks like a table and should be the fourth one from the right on the GeoDa toolbar. Open the attribute table for NC_ZIP_Lyme_2016_2018.gpkg. Note that each observation has a Zip Code, name, population count (<code>pop20</code>), and count of Lyme Disease cases over this period (<code>cases</code>).</p></li>
</ol>
<hr>
</section>
<section id="map-and-calculate-incidence-rate" class="level3">
<h3 class="anchored" data-anchor-id="map-and-calculate-incidence-rate">Map and Calculate Incidence Rate</h3>
<ol start="4" type="1">
<li><p>Navigate to Map | Rates-Calculated Map | Empirical Bayes (or right click in the map area and choose Rates | Empirical Bayes). Choose cases for the Event Variable and pop for the Base Variable, and then change the Map Themes to Natural Breaks and the number of Categories to 5. Click OK.</p></li>
<li><p>Write the Empirical Bayes Rates to the attribute table of NC_ZIP_Lyme_2016_2018.gpkg, right click in the map and choose Save Rates (you can leave the default name).</p></li>
</ol>
<hr>
</section>
<section id="define-neighbors" class="level3">
<h3 class="anchored" data-anchor-id="define-neighbors">Define Neighbors</h3>
<p>Prior to completing any spatial autocorrelation analysis, we need to define our neighborhood (allows us to compare between things that are “near”).</p>
<ol start="6" type="1">
<li><p>Click the Weights button on the toolbar (the big W) or navigate in the top menu to Tools | Weights Manager. In the Weights Manager popup window, click Create (since we don’t have any created yet). Use zip_code as the ID Variable. Choose 1st order, Queen contiguity weights (should be the default). Click Create and save the weights to the same location as NC_ZIP_Lyme_2016_2018_Queen_1.gal in the exercise #9 data folder. NOTE: you will get a warning about a neighborliness observation, that is okay!</p></li>
<li><p>GeoDa provides some basic information and a few tools to explore the nature of the neighborhood definition via the weights manager.</p></li>
</ol>
<p><span style="color: red;"><strong>Q1. What is the average number of neighbors given 1st order, Queen contiguity?</strong></span></p>
<hr>
</section>
<section id="global-spatial-autocorrelation" class="level3">
<h3 class="anchored" data-anchor-id="global-spatial-autocorrelation">Global Spatial Autocorrelation</h3>
<p>We use <em>global</em> spatial autocorrelation metrics to answer the question, “considering all the observations (values), is the overall pattern clustered, random, or dispersed?” You will now answer this question for Lyme Disease incidence rates in NC.</p>
<ol start="8" type="1">
<li><p>Calculate Moran’s I. To do this, in the top menu, click on <strong>Space | Univariate Moran’s I</strong>. <strong>Choose R_EBS</strong> (Empirical Bayes smoothed rates) as the First variable, as we are testing the spatial pattern of the rates of Lyme Disease. Make sure NC_ZIP_Lyme_2016_2018_Queen_1 is selected for the weights. Click OK. <em>NOTE: Because some of the tracts do not have any contiguous neighbors, you should get a warning stating this. This is okay.</em></p></li>
<li><p>You should get a popup window containing a Moran’s I scatterplot with the Moran’s I value at the top. To run a hypothesis test (and get a p-value) comparing the results to a null hypothesis of complete spatial randomness (CSR), right click anywhere inside the Moran’s I window and choose <strong>Randomization | 999 Permutations</strong>. You should get another popup window that contains the pseudo p-value based on the value of your data compared to the random permutations.</p></li>
</ol>
<p><span style="color: red;"><strong>Q.2 What is the Moran’s I value and pseudo p-value? What is your interpretation of this output?</strong></span></p>
<hr>
</section>
<section id="local-spatial-autocorrelation" class="level3">
<h3 class="anchored" data-anchor-id="local-spatial-autocorrelation">Local Spatial Autocorrelation</h3>
<p>We often want to understand spatial autocorrelation at a regional level. We use local spatial autocorrelation metrics (e.g., LISA, Getis Ord G*) to accomplish this. These methods produce a measure of autocorrelation for each observation in your data, thus allowing you to identify hotspots and coldspots, as well as spatial outlier values.</p>
<ol start="10" type="1">
<li><p>In the top menu, click on <strong>Space | Univariate Local Moran’s I</strong>. Choose <strong>R_EBS (Empirical Bayes smoothed rates)</strong> as the First variable, as we are testing the spatial pattern of the rates of Lyme Disease. Make sure NC_ZIP_Lyme_2016_2018_Queen_1 is selected for the weights. Click OK. You will get a popup window asking “What windows to open?”. Make sure that all options are selected and click OK.</p></li>
<li><p>Right click in one of the pop up maps. Change the <u><strong>Significance Filter from 0.05 to 0.01</strong></u>. Note that the number of Zip Codes highlighted in both maps change!</p></li>
</ol>
<p><span style="color: red;"><strong>Q.3) Paste this map (screenshot is ok) into your word file. How many Zip Codes were identified as being in a High High cluster? How many in a Low Low cluster? Provide a short explanation of why one would expect the pattern of High High observations and Low High outliers given the original choropleth map?</strong></span></p>
<hr>
<ol start="12" type="1">
<li>Now, create a new set of weights using a choice of distance weights (distance threshold or K-nearest neighbors. For distance threshold, make sure to choose a distance above the minimum threshold, and for K-nearest neighbors, choose a number between 4-10.</li>
</ol>
<p><span style="color: red;"><strong>Q4-6. Answer Q1-3 again but using the new chosen weights.</strong></span></p>
<ol start="13" type="1">
<li>Save your file with your answer and upload to your relevant OneDrive folder.</li>
</ol>
<hr>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>